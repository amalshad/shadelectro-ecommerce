<%-include("../partials/user/header")%>

  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <div class="hero-content">
        <div class="hero-text animate-slide-in-left">
          <div class="best-prices-tag animate-bounce-in">Best Prices</div>
          <h1 class="hero-title">Incredible Prices on All Your Favorite Items</h1>
          <p class="hero-description">Get more for less price, Grab now</p>
          <a href="/shop" class="btn btn-primary btn-animated">
            <span>Shop Now</span>
            <i class="fas fa-arrow-right"></i>
          </a>
        </div>
        <div class="hero-image animate-slide-in-right">
          <div class="image-container">
            <img src="/images/img1.avif" alt="Latest technology devices">
            <div class="floating-elements">
              <div class="floating-icon floating-icon-1">
                <i class="fas fa-laptop"></i>
              </div>
              <div class="floating-icon floating-icon-2">
                <i class="fas fa-mobile-alt"></i>
              </div>
              <div class="floating-icon floating-icon-3">
                <i class="fas fa-headphones"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Trending Items -->
  <section class="product-section">
    <div class="container">
      <h2 class="section-title animate-fade-in-up">Trending Items</h2>
      <div class="product-slider">
        <button class="slider-arrow prev-arrow" onclick="slideProducts('prev')">
          <i class="fas fa-chevron-left"></i>
        </button>
        <div class="product-grid" id="productGrid">
          <% products.forEach((product, index)=> { %>
            <div class="product-card animate-fade-in-up" style="animation-delay: <%= index * 0.1 %>s">
              <% const variant=product.variants && product.variants[0]; 
              const hasSale=variant && variant.salesPrice && variant.regularPrice && variant.salesPrice < variant.regularPrice; %>

                <% if (hasSale) { %>
                  <div class="sale-badge pulse-animation">SALE</div>
                  <% } %>

                    <a href="/shop/<%= product._id %>" class="product-link">
                      <div class="product-image">
                        <img src="/uploads/productImages/<%= variant.productImage[0] %>"
                          alt="<%= product.productName %>">
                        <div class="product-overlay">
                          <div class="overlay-content">
                            <i class="fas fa-eye"></i>
                            <span>Quick View</span>
                          </div>
                        </div>
                      </div>
                      <div class="product-info">
                        <h3 class="product-name">
                          <%= product.productName %>
                        </h3>
                        <div class="product-price">
                          <% if (variant) { %>
                            <% if (variant.finalPrice) { %>
                              <span class="current-price">₹<%= variant.finalPrice.toFixed(2) %></span>
                              <span class="original-price">₹<%= variant.salesPrice.toFixed(2) %></span>
                              <% } else if (variant.salesPrice) { %>
                                <span class="current-price">₹<%= variant.salesPrice.toFixed(2) %></span>
                                <% } else { %>
                                  <span class="current-price">₹0.00</span>
                                  <% } %>
                                    <% } else { %>
                                      <span class="current-price">₹0.00</span>
                                      <% } %>
                        </div>
                      </div>
                    </a>

                    <div class="product-actions">
                      <button class="action-btn wishlist-btn" onclick="addToWishlist('<%= product._id %>')">
                        <i class="fas fa-heart"></i>
                      </button>
                      <button class="action-btn cart-btn" onclick="addToCart('<%= product._id %>')">
                        <i class="fas fa-shopping-cart"></i>
                      </button>
                    </div>
            </div>
            <% }); %>
        </div>
        <button class="slider-arrow next-arrow" onclick="slideProducts('next')">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
      <div class="view-all-container animate-fade-in-up">
        <a href="/shop" class="btn btn-primary btn-animated">
          <span>View All</span>
          <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="features">
    <div class="container">
      <h2 class="section-subtitle animate-fade-in-up">Why Choose Us</h2>
      <div class="features-grid">
        <div class="feature-card animate-fade-in-up" style="animation-delay: 0.1s">
          <div class="feature-icon">
            <i class="fas fa-award"></i>
          </div>
          <h3>Premium Quality</h3>
          <p>High-end peripherals and accessories from top gaming brands</p>
        </div>
        <div class="feature-card animate-fade-in-up" style="animation-delay: 0.2s">
          <div class="feature-icon">
            <i class="fas fa-shipping-fast"></i>
          </div>
          <h3>Fast Delivery</h3>
          <p>Express shipping for your gaming gear worldwide</p>
        </div>
        <div class="feature-card animate-fade-in-up" style="animation-delay: 0.3s">
          <div class="feature-icon">
            <i class="fas fa-headset"></i>
          </div>
          <h3>24/7 Support</h3>
          <p>Expert technical assistance for all your accessories</p>
        </div>
        <div class="feature-card animate-fade-in-up" style="animation-delay: 0.4s">
          <div class="feature-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <h3>Secure Payment</h3>
          <p>Safe & encrypted payment using modern protocols</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Help Center Banner -->
  <section class="help-center-banner">
    <div class="container">
      <div class="help-banner-grid">
        <div class="help-content animate-slide-in-left">
          <h2>Need Help? Check Out Our Help Center</h2>
          <p>If you need any help Check Out our Help Center or need to send any Feedback! Let your thoughts to know</p>
          <a href="/contact" class="btn btn-outline-light btn-animated">
            <span>Go to Help Center</span>
            <i class="fas fa-arrow-right"></i>
          </a>
        </div>
        <div class="help-image animate-slide-in-right">
          <img src="/images/help.jpg" alt="Tech support">
        </div>
      </div>
    </div>
  </section>

   <div class="toast" id="successToast">
    <div class="toast-content">
      <i class="fas fa-check-circle"></i>
      <span class="toast-message">Item added successfully!</span>
    </div>
  </div>

<%-include("../partials/user/footer") %>

  <!-- Back to Top Button -->
  <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- JavaScript -->
   <script>
// Intersection Observer for animations
const observerOptions = {
  threshold: 0.1,
  rootMargin: '0px 0px -50px 0px'
};

const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add('animate-visible');
    }
  });
}, observerOptions);

// Observe all animated elements
document.addEventListener('DOMContentLoaded', function () {
  const animatedElements = document.querySelectorAll('[class*="animate-"]');
  animatedElements.forEach(el => observer.observe(el));
});

// Responsive Product slider functionality
let currentSlide = 0;
let slidesToShow = 4;

function updateSlidesToShow() {
  const width = window.innerWidth;
  if (width <= 576) {
    slidesToShow = 1;
  } else if (width <= 768) {
    slidesToShow = 2;
  } else if (width <= 992) {
    slidesToShow = 3;
  } else {
    slidesToShow = 4;
  }
}

function slideProducts(direction) {
  const productGrid = document.getElementById('productGrid');
  const products = productGrid.children;
  const totalProducts = products.length;
  
  updateSlidesToShow();
  const maxSlide = Math.max(0, totalProducts - slidesToShow);

  if (direction === 'next' && currentSlide < maxSlide) {
    currentSlide++;
  } else if (direction === 'prev' && currentSlide > 0) {
    currentSlide--;
  }

  const translateX = -(currentSlide * (100 / slidesToShow));
  productGrid.style.transform = `translateX(${translateX}%)`;
}

// Reset slider on window resize
window.addEventListener('resize', function() {
  currentSlide = 0;
  const productGrid = document.getElementById('productGrid');
  if (productGrid) {
    productGrid.style.transform = 'translateX(0%)';
  }
});

// Back to top functionality
window.addEventListener('scroll', function () {
  const backToTop = document.getElementById('backToTop');
  if (window.pageYOffset > 300) {
    backToTop.classList.add('visible');
  } else {
    backToTop.classList.remove('visible');
  }
});

function scrollToTop() {
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}

    async function addToCart(productId, button) {
        const user = <%- JSON.stringify(user || null) %>;
  
  if (!user) {
    showToast("Please login to add items to cart!", 'error');
    return;
  }
      try {
        const variantIndex = 0;
        const quantity = 1;

        const res = await fetch('/cart', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ productId, variantIndex, quantity })
        });

        const data = await res.json();

        if (data.success) {
          // button.classList.remove('loading');
          // button.classList.add('success');
          // button.innerHTML = '<i class="fas fa-check"></i>';

          showToast("Item added to cart successfully!");;

          setTimeout(() => {
            button.classList.remove('success');
            button.innerHTML = '<i class="fas fa-shopping-cart"></i>';
          }, 2000);
        } else {
          showToast(data.message || "Failed to add to cart");
        }
      } catch (error) {
        console.error("Error adding to cart:", error);
        showToast("Something went wrong. Try again.");
      }
    }

// Enhanced Add to wishlist functionality
    async function addToWishlist(productId, button) {
      const user = <%- JSON.stringify(user || null) %>;
  
  if (!user) {
    showToast("Please login to add items to wishlist!", 'error');
    return;
  }
      try {
        const res = await fetch('/wishlist', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ productId })
        });

        const data = await res.json();

        if (data.success) {

          
          showToast("Added to wishlist!");

          setTimeout(() => {
            button.classList.remove('success');
            icon.className = 'fas fa-heart';
          }, 2000);
        } else {
          showToast(data.message || "Already in wishlist");
        }
      } catch (error) {
        console.error("Error adding to wishlist:", error);
        showToast("Failed to add to wishlist");
      }
    }

function showToast(message, type = 'success') {
  const toast = document.getElementById('successToast');
  const messageElement = toast.querySelector('.toast-message');
  
  messageElement.textContent = message;
  toast.classList.add('show');
  
  // Add error styling if needed
  if (type === 'error') {
    toast.classList.add('error');
  } else {
    toast.classList.remove('error');
  }
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// Touch swipe support for mobile product slider
let startX = 0;
let startY = 0;

document.addEventListener('DOMContentLoaded', function() {
  const productSlider = document.querySelector('.product-slider');
  
  if (productSlider && window.innerWidth <= 768) {
    productSlider.addEventListener('touchstart', function(e) {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });
    
    productSlider.addEventListener('touchend', function(e) {
      const endX = e.changedTouches[0].clientX;
      const endY = e.changedTouches[0].clientY;
      const diffX = startX - endX;
      const diffY = startY - endY;
      
      // Only trigger if horizontal swipe is greater than vertical
      if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
        if (diffX > 0) {
          slideProducts('next');
        } else {
          slideProducts('prev');
        }
      }
    });
  }
});

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault();
    const target = document.querySelector(this.getAttribute('href'));
    if (target) {
      target.scrollIntoView({
        behavior: 'smooth',
        block: 'start'
      });
    }
  });
});

// Reduced parallax effect for mobile performance
window.addEventListener('scroll', function () {
  if (window.innerWidth > 768) {
    const scrolled = window.pageYOffset;
    const heroImage = document.querySelector('.hero-image img');
    if (heroImage) {
      heroImage.style.transform = `translateY(${scrolled * 0.3}px)`;
    }
  }
});
</script>

  <script>
    // Loading screen
    window.addEventListener('load', function () {
      const loadingScreen = document.getElementById('loadingScreen');
      loadingScreen.style.opacity = '0';
      setTimeout(() => {
        loadingScreen.style.display = 'none';
      }, 500);
    });

    // Intersection Observer for animations
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-visible');
        }
      });
    }, observerOptions);

    // Observe all animated elements
    document.addEventListener('DOMContentLoaded', function () {
      const animatedElements = document.querySelectorAll('[class*="animate-"]');
      animatedElements.forEach(el => observer.observe(el));
    });

    // Product slider functionality
    let currentSlide = 0;
    const slidesToShow = 4;

    function slideProducts(direction) {
      const productGrid = document.getElementById('productGrid');
      const products = productGrid.children;
      const totalProducts = products.length;
      const maxSlide = Math.max(0, totalProducts - slidesToShow);

      if (direction === 'next' && currentSlide < maxSlide) {
        currentSlide++;
      } else if (direction === 'prev' && currentSlide > 0) {
        currentSlide--;
      }

      const translateX = -(currentSlide * (100 / slidesToShow));
      productGrid.style.transform = `translateX(${translateX}%)`;
    }

    // Back to top functionality
    window.addEventListener('scroll', function () {
      const backToTop = document.getElementById('backToTop');
      if (window.pageYOffset > 300) {
        backToTop.classList.add('visible');
      } else {
        backToTop.classList.remove('visible');
      }
    });

    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

 

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Add parallax effect to hero section
    window.addEventListener('scroll', function () {
      const scrolled = window.pageYOffset;
      const heroImage = document.querySelector('.hero-image img');
      if (heroImage) {
        heroImage.style.transform = `translateY(${scrolled * 0.5}px)`;
      }
    });

 
  </script>
</body>

</html>